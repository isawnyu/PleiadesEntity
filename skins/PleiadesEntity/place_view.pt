<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en"
      lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="plone">
  
  <head>
    
    <metal:links_macro metal:define-macro="links"
      tal:define="url context/absolute_url;
                  baseline context/@@iterate/baseline|nothing;" >
      <link rel="foaf:primaryTopic" tal:attributes="href string:${url}#this"/>
      <link rel="where" type="application/json" tal:attributes="href context/@@json/data_uri"/>
      <link tal:condition="baseline"
        rel="baseline-where" 
        type="application/json" 
        tal:attributes="href baseline/@@json/data_uri" />
      <link rel="connections" type="application/json" tal:attributes="href context/@@connections-json/data_uri"/>
      <link rel="r-where" type="application/json" tal:attributes="href context/@@r-neighbors-json/data_uri"/>
      <link rel="nofollow alternate" type="application/atom+xml" tal:attributes="href string:${url}/atom"/>
      <link rel="nofollow alternate" type="application/json" tal:attributes="href string:${url}/@@json?sm=1"/>
      <link rel="nofollow alternate" type="application/vnd.google-earth.kml+xml" tal:attributes="href string:${url}/kml"/>
      <link rel="canonical" tal:attributes="href url"/>

      <span tal:replace="structure context/@@neighborhood/p_link">P LINK</span>
      <span tal:replace="structure context/@@neighborhood/r_link">R LINK</span>

    </metal:links_macro>
    
    <metal:js_macro metal:define-macro="js">
      
      <script 
        type="text/javascript"
        src="http://maps.googleapis.com/maps/api/js?sensor=false">
      </script>
      
      <script 
        type="text/javascript"
        src="context_map.js">
      </script>
    
    </metal:js_macro>

  </head>
  
  <body>

    <metal:header_macro define-macro="header"
      tal:define="kssClassesView context/@@kss_field_decorator_view;
                  getKssClasses nocall:kssClassesView/getKssClassesInlineEditable">

      <div itemscope itemtype="http://schema.org/Place">
      <div tal:replace="structure provider:plone.abovecontenttitle" />
      <h1 itemprop="name" tal:content="here/title_or_id">
        Title or id
      </h1>
      <div tal:replace="structure provider:plone.belowcontenttitle" />

      <!--p><strong>Primary Topic</strong> [<a href="http://xmlns.com/foaf/spec/#term_primaryTopic">about</a>]: 
      <a rel="foaf:primaryTopic" tal:attributes="href string:${here/absolute_url}#this" tal:content="string:${here/absolute_url}#this">THIS</a> 
      [<a type="application/rdf+xml" rel="nofollow alternate"
               tal:attributes="href string:${here/absolute_url}/rdf">RDF+XML</a>,
           <a type="text/turtle" rel="nofollow alternate"
               tal:attributes="href string:${here/absolute_url}/turtle">Turtle</a>]
      </p-->

      <p itemprop="description" 
        class="documentDescription"
        tal:content="here/Description">
        Description</p>

      <a itemprop="maps" href="" style="display:none"
        tal:attributes="href string:http://maps.google.com/maps?f=q&q=${here/absolute_url}/neighborhood-kml">URL</a>

      <div tal:replace="structure provider:plone.abovecontentbody" />
      
      </div>

    </metal:header_macro>

    <metal:body_macro
      metal:define-macro="body"
      tal:define="field_macro field_macro | here/widgets/field/macros/view;
        kssClassesView context/@@kss_field_decorator_view;
        getKssClasses nocall:kssClassesView/getKssClassesInlineEditable;
        templateId template/getId;
        portal_state context/@@plone_portal_state;
        context_state context/@@plone_context_state">

      <table id="map-children">
        <tr>

          <td id="map-column" title="Locations of this particular place are shown in blue. Nearby precisely located places are shown in brown. Nearby places which are only roughly located are collected in groups displayed as clouds.">
            <div id="map"></div>
          </td>

          <td id="fields-column" title="The authority rating, title and attested time periods of this place's names and locations are listed here. Red titles indicate drafting-state and yellow, pending-state. Mouse over any title to raise an info window over the location in the map.">

            <div tal:condition="not:context/@@iterate/baseline|nothing">
            <div id="locationsField" class="field">
              <label>Locations</label>
            <dl tal:replace="structure context/@@locations-listing"></dl>
            <a tal:condition="not:portal_state/anonymous"
              class="createObjectButton"
              href="createObject?type_name=Location" 
              title="Create a new Location"
              >Add Location</a>
            </div>
            <div id="namesField" class="field">
              <label>Names</label>
            <dl tal:replace="structure context/@@names-listing"></dl>
            <a tal:condition="not:portal_state/anonymous"
              class="createObjectButton"
              href="createObject?type_name=Name"
              title="Create a new Name"
              >Add Name</a>
            </div>
            <div tal:condition="python:context.portal_membership.checkPermission('List folder contents', context)"><p>
              <a href="folder_contents">Folder listing of locations and names</a>
            </p></div>
            </div>

            <div tal:condition="context/@@iterate/baseline|nothing"
              tal:define="baseline context/@@iterate/baseline" >

            <div tal:condition="context/@@iterate/baseline|nothing">
            <h3 style="margin-top:0px;">In this working copy</h3>
            <p>These will be copied to the baseline place when a reviewer checks the working copy in.</p>
            <div id="locationsField" class="field">
              <label>Locations</label>
            <dl tal:replace="structure context/@@locations-listing"></dl>
            <a tal:condition="not:portal_state/anonymous"
              class="createObjectButton"
              href="createObject?type_name=Location" 
              title="Create a new Location"
              >Add Location</a>
            </div>
            <div id="namesField" class="field">
              <label>Names</label>
            <dl tal:replace="structure context/@@names-listing"></dl>
            <a tal:condition="not:portal_state/anonymous"
              class="createObjectButton"
              href="createObject?type_name=Name"
              title="Create a new Name"
              >Add Name</a>
            </div>

            <h3 style="margin-top:2em">In the baseline place</h3>
            <div id="locationsField" class="field baseline">
              <label>Locations</label>
              <dl tal:replace="structure baseline/@@locations-listing"></dl>
            </div>
            <div id="namesField" class="field">
              <label>Names</label>
              <dl tal:replace="structure baseline/@@names-listing"></dl>
            </div>
            </div>

            <div tal:condition="python:context.portal_membership.checkPermission('List folder contents', context)"><p>
              <a href="folder_contents">Folder listing of locations and names</a>
            </p></div>
            </div>

          </td> <!-- fields -->

        </tr>
      </table>

      <div id="fields-continued">

        <tal:repeat
          repeat="field python:here.Schema().filterFields(isMetadata=0)">
          <tal:if_visible
            define="mode string:view; visState python:field.widget.isVisible(here, mode); visCondition python:field.widget.testCondition(here, portal, template);"
            condition="python:visState == 'visible' and visCondition">
            <metal:use_field use-macro="field_macro"/>
          </tal:if_visible>
        </tal:repeat>

        <div class="field">
          <label>Canonical URI for this page:</label>
          <br/>
          <code tal:content="context/absolute_url"></code>
        </div>

        <div class="field">
          <label>Alternate representations:</label>
          <br/>
          <span tal:define="url context/absolute_url">
            <a type="application/atom+xml" rel="nofollow alternate"
               tal:attributes="href string:${url}/atom">Atom</a>,
            <a type="application/json" rel="nofollow alternate"
               tal:attributes="href string:${url}/json">JSON</a>,
            <a type="application/vnd.google-earth.kml+xml" rel="nofollow alternate"
               tal:attributes="href string:${url}/kml">KML</a>,
            <a type="application/vnd.google-earth.kml+xml" rel="nofollow alternate"
               tal:attributes="href string:${url}/neighborhood-kml">KML (Neighborhood)</a>,
           <a type="application/rdf+xml" rel="nofollow alternate"
               tal:attributes="href string:${url}/rdf">RDF+XML</a>,
           <a type="text/turtle" rel="nofollow alternate"
               tal:attributes="href string:${url}/turtle">Turtle</a>
          </span>
        </div>

        <div class="field">
          <label><span>Suggested citation:</label>
          <br/>
<span tal:replace="here/citationAuthors">R. Talbert</span>.
"Places: <span tal:replace="here/getId">ID</span> (<span tal:replace="here/Title">TITLE</span>)". Pleiades.
&lt;<span tal:replace="here/absolute_url">http://opencontext.org/subjects/HazorZooSPA0000009703</span>&gt; [Accessed: <span tal:replace="python:DateTime().fCommon() or ''">2006-05-12</span>]
        </div>

        <div class="field">
          <label><span>Cite this resource in Wikipedia:</label>
          <br/>
<pre>
{{cite web |url=<span tal:replace="here/absolute_url">http://example.com/foo</span> |title=Places: <span tal:replace="here/getId">ID</span> (<span tal:replace="here/Title">TITLE</span>) |author=<span tal:replace="here/citationAuthors">R. Talbert</span> |accessdate=<span tal:replace="python:DateTime().fCommon() or ''">2006-05-12</span> |publisher=Pleiades}}
</pre>
        </div>

      </div>

<script type="text/javascript">
<!--

  jq(".Location").mouseover(raiseInMap);
  jq(".Location").mouseout(function(){infoWindow.close();});

  -->
</script>

    </metal:body_macro>
   
    <metal:folderlisting_macro define-macro="folderlisting">
      <!-- nothing -->
    </metal:folderlisting_macro>

  </body>
</html>

