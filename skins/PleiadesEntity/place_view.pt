<html xmlns="http://www.w3.org/1999/xhtml"
          xmlns:tal="http://xml.zope.org/namespaces/tal"
          xmlns:metal="http://xml.zope.org/namespaces/metal"
          xmlns:i18n="http://xml.zope.org/namespaces/i18n"
          i18n:domain="plone">
      <head>
        <title></title>
        <head>
          <metal:block metal:define-macro="js">
            <script type="text/javascript" src="/ol/lib/OpenLayers.js"></script>
            <script type="text/javascript" src="ol.js"
              tal:attributes="src string:${context/absolute_url}/ol.js"></script>
          </metal:block>
        </head>
      </head>
      
      <body>


        <metal:body_macro 
		  metal:define-macro="body"
		  >

          <div id="mapzonebox"
            tal:define="query_results python:context.portal_catalog.searchResults({'path':{'query':'/'.join(context.restrictedTraverse('..').getPhysicalPath()),'depth':1}, 'portal_type':'MapContext'})"
            tal:condition="python:len(query_results) > 0"
            >
            <div id="mappish" style="float:right;width:200px;border:none;">
                <div id="map" style="float:right;width:200px;height:300px;border:solid gray 1px;background-color:#cccccc;"></div>
                <div id="gelink" style="float:right;"><span class="link-external"><a href="nwlink">Open in Google Earth</a></span></div>
            </div>
            <script
              tal:define="mapcontext python:query_results[0].getObject();
                          feature_json string:${context/json};
                          map_json string:${mapcontext/json};"
              defer="defer"
              type="text/javascript"
              tal:content="python:''' 
              var map = eval('(%s)');
              var feature = eval('(%s)');
              if (feature.center != null)
              {
                mapFeature(map, feature, 1/500000);
              }
              ''' % (map_json, feature_json)"
              >
            </script>
            
          </div>
          
       	  <div
		    tal:define="field_macro field_macro | here/widgets/field/macros/view;"
            tal:repeat="field python:here.Schema().filterFields(isMetadata=0)"
		    >
          <tal:if_visible
		    define="mode string:view;
            	visState python:field.widget.isVisible(here, mode);
                visCondition python:field.widget.testCondition(here, portal, template);"
        	condition="python:visState == 'visible' and visCondition"
			>
            <metal:use_field
			  use-macro="field_macro"
			  />
          </tal:if_visible>
		  </div>
           
        </metal:body_macro>
		
        <metal:folderlisting_macro metal:define-macro="folderlisting"
                                   tal:define="fl_macro here/folder_listing/macros/listing | nothing;
                                               folderish here/isPrincipiaFolderish | nothing;">
            <tal:if_folderlisting condition="python:folderish and fl_macro">
                <h2>Names</h2>
                <metal:use_macro use-macro="fl_macro" />
            </tal:if_folderlisting>
        </metal:folderlisting_macro>
        
      </body>
    </html>
