BatchCreation.txt
=====================

Test batch creation of GeographicEntityLite objects. The values against which verifications are performed in these tests are loaded from the xml file batlas-65-2-24.xml, located in GeographicEntityLite/tests/data. We begin by loading from file, and thoroughly testing, a single entity. Then, we batch load all the xml files in GeographicEntityLite/tests/data and perform some basic tests (counting, checking ids), but -- for now at least -- we do not test everything derived from every single file.

A lot of this is cribbed from optilude's tutorial on plone.org.

Setup the test fixture
    >>> folder = self.folder

Load a single entity
    >>> import os
    >>> source_dir = os.path.sep.join([os.environ['SOFTWARE_HOME'], 'Products', 'GeographicEntityLite', 'tests', 'data'])
    >>> from Products.GeographicEntityLite.Extensions.batching import load_entity
    >>> source = "%s/batlas-65-2-24.xml" % (source_dir)
    >>> load_entity(folder, source)

Check count of created entities
    >>> entities = folder.listFolderContents()
    >>> len(entities)
    1

Get entity reference for further testing
    >>> en = entities[0]
    
Verify the id is properly set
    >>> en.getId()
    'batlas-65-2-24'

Verify the title is properly set
    >>> en.Title()
    'batlas-65-2-24'

Verify the description is properly set
    >>> en.Description()
    'No description'
    
Verify the entity type is properly set
    >>> en.getGeoEntityType()
    'settlement'

Verify the modern location is properly set
    >>> en.getModernLocation()
    'Geyre'

Verify the time period(s) are properly set
    >>> en.getTimePeriods()
    ('Classical', 'Roman', 'Late Antique')

Verify the secondary reference(s) are properly set
    >>> en.getSecondaryReferences()
    ('BAtlas 65 A2 Aphrodisias/Ninoe', 'RE 2', 'NPauly 1', 'RE')

Verify the spatial coordinates are properly set
    >>> en.getSpatialCoordinates()
    '37.7144599999992 28.7288599999993 0.0'

Check count of names
    >>> names = en.listFolderContents()
    >>> len(names)
    2
    
Get reference to the first name for further testing
    >>> nm0 = names[0]

Verify the id is properly set
    >>> nm0.getId()
    'batlas-65-2-24-n1'
    
Verify the title is properly set
    >>> nm0.Title()
    'batlas-65-2-24-n1'
    
Verify the attested name is properly set
    >>> nm0.getNameAttested()
    ''

Verify the transliterated name is properly set    
    >>> nm0.getNameTransliterated()
    'Aphrodisias'

Verify the name language is properly set
    >>> nm0.getNameLanguage()
    ''

Verify the time period(s) for this name are properly set
    >>> nm0.getTimePeriods()
    ('Roman', 'Late Antique')
    
Verify the primary references for this name are properly set
    >>> nm0.getPrimaryReferences()
    ()
    
Verify the secondary references for this name properly set
    >>> nm0.getSecondaryReferences()
    ('RE 2', 'NPauly 1')
    
Do the same things for the second name
    >>> nm1 = names[1]

    >>> nm1.getId()
    'batlas-65-2-24-n2'
    
    >>> nm1.Title()
    'batlas-65-2-24-n2'
    
    >>> nm1.getNameAttested()
    ''
    
    >>> nm1.getNameTransliterated()
    'Ninoe'

    >>> nm1.getNameLanguage()
    ''

    >>> nm1.getTimePeriods()
    ('Classical',)
    
    >>> nm1.getPrimaryReferences()
    ()
    
    >>> nm1.getSecondaryReferences()
    ('RE',)

Delete the entity and check for result
    >>> folder.manage_delObjects(['batlas-65-2-24'])
    >>> entities = folder.listFolderContents()
    >>> len(entities)
    0

Load a whole batch of entities
    >>> from Products.GeographicEntityLite.Extensions.batching import loaden
    >>> loaden(folder, source_dir)

Check count of created entities
    >>> entities = folder.listFolderContents()
    >>> len(entities)
    7
    
Check ids of created entities
    >>> en_ids = []
    >>> en_ids.append(entities[0].getId())
    >>> en_ids.append(entities[1].getId())
    >>> en_ids.append(entities[2].getId())
    >>> en_ids.append(entities[3].getId())
    >>> en_ids.append(entities[4].getId())
    >>> en_ids.append(entities[5].getId())
    >>> en_ids.append(entities[6].getId())
    >>> 'batlas-65-2-3' in en_ids
    True
    >>> 'batlas-65-2-4' in en_ids
    True
    >>> 'batlas-65-2-12' in en_ids
    True
    >>> 'batlas-65-2-19' in en_ids
    True
    >>> 'batlas-65-2-20' in en_ids
    True
    >>> 'batlas-65-2-22' in en_ids
    True
    >>> 'batlas-65-2-24' in en_ids
    True

