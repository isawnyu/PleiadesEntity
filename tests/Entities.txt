
Tests of relationships among Name, Location, and Place
======================================================

Setup
-----

    Check catalogs

    >>> uc = self.portal.uid_catalog
    >>> rc = self.portal.reference_catalog

    Enable types

    >>> lpf = self.portal.portal_types['Large Plone Folder']
    >>> lpf_allow = lpf.global_allow
    >>> lpf.global_allow = True

    >>> n = self.portal.portal_types['Name']
    >>> n_allow = n.global_allow
    >>> n.global_allow = True

    Alias the test folder

    >>> folder = self.folder

    Containers

    >>> _ = folder.invokeFactory('Large Plone Folder', id='names')
    >>> _ = folder.invokeFactory('LocationContainer', id='locations')
    >>> _ = folder.invokeFactory('PlaceContainer', id='places')
    >>> names = folder.names
    >>> locations = folder.locations
    >>> places = folder.places

    Entities

    >>> _ = names.invokeFactory('Name', id='neverpolis', title='Neverpolis', nameType='geographic')
    >>> lid = locations.invokeFactory('Location')
    >>> pid = places.invokeFactory('Place')
    >>> p = getattr(folder.places, pid)
    >>> aid = p.invokeFactory('PlacefulAssociation', id="neverpolis-%s" % lid)

    Add References

    >>> n = getattr(names, 'neverpolis')
    >>> x = getattr(locations, lid)
    >>> a = getattr(p, aid)
    >>> _ = a.addReference(n, 'hasName')
    >>> _ = a.addReference(x, 'hasLocation')

    Set location coordinates

    >>> _ = x.setSpatialCoordinates('34.769722222222 -86.4808333333333 0.0')

Test the geo adapters
---------------------

    >>> from Products.PleiadesGeocoder.interfaces import IGeoItemSimple, IGeoCollectionSimple

    Place Association

    >>> g = IGeoItemSimple(a)
    >>> g.isGeoreferenced()
    True
    >>> info = {'srs': 'EPSG:4326', 'geometryType': 'point', 'description': '', 'spatialCoordinates': '34.7697222222 -86.4808333333 0.0', 'url': 'http://nohost/plone/Members/test_user_1_/places/%s/%s' % (pid, aid), 'title': 'Neverpolis', 'id': aid}
    >>> g.getInfo() == info
    True

    Place

    >>> g = IGeoItemSimple(p)
    >>> g.isGeoreferenced()
    True
    >>> info = {'srs': 'EPSG:4326', 'geometryType': 'point', 'description': '', 'spatialCoordinates': '34.7697222222 -86.4808333333 0.0', 'url': 'http://nohost/plone/Members/test_user_1_/places/%s' % pid, 'title': 'Neverpolis', 'id': pid}
    >>> g.getInfo() == info
    True

    >>> c = IGeoCollectionSimple(places)
    >>> c.getItemsInfo() == [{'srs': 'EPSG:4326', 'geometryType': 'point', 'description': '', 'spatialCoordinates': '34.7697222222 -86.4808333333 0.0', 'url': 'http://nohost/plone/Members/test_user_1_/places/%s' % pid, 'title': 'Neverpolis', 'id': pid}]
    True

