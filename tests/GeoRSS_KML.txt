GeoRSS and KML views
====================

Test logical view of a collection of entities

Setup
-----

    >>> lpf = self.portal.portal_types['Large Plone Folder']
    >>> lpf_allow = lpf.global_allow
    >>> lpf.global_allow = True

    >>> n = self.portal.portal_types['Name']
    >>> n_allow = n.global_allow
    >>> n.global_allow = True

    >>> folder = self.folder

    Containers

    >>> _ = folder.invokeFactory('Large Plone Folder', id='names')
    >>> _ = folder.invokeFactory('LocationContainer', id='locations')
    >>> _ = folder.invokeFactory('PlaceContainer', id='places')
    >>> names = folder.names
    >>> locations = folder.locations
    >>> places = folder.places

    Entities

    >>> _ = names.invokeFactory('Name', id='neverpolis', title='Neverpolis', nameType='geographic')
    >>> lid = locations.invokeFactory('Location')
    >>> pid = places.invokeFactory('Place', id='54321')
    >>> p = getattr(folder.places, pid)
    >>> aid = p.invokeFactory('PlacefulAssociation', id="neverpolis-%s" % lid)

    Add References

    >>> n = getattr(names, 'neverpolis')
    >>> x = getattr(locations, lid)
    >>> a = getattr(p, aid)
    >>> _ = a.addReference(n, 'hasName')
    >>> _ = a.addReference(x, 'hasLocation')

    Set location coordinates and place attributes

    >>> x.setSpatialCoordinates('0.0 0.0 0.0')
    >>> p.setDescription('A testing entity')

Test browse
-----------

    Initialize the test browser

    >>> from Products.Five.testbrowser import Browser
    >>> browser = Browser()
    >>> browser.handleErrors = False

    Let us log all exceptions, which is useful for debugging. Also, clear
    portlet slots, to make the test browser less confused by things like the
    recent portlet and the navtree.

    >>> self.portal.error_log._ignored_exceptions = ()
    >>> self.portal.left_slots = self.portal.right_slots = []

    >>> url = places.absolute_url()

    GeoRSS

    >>> browser.open("%s/georss" % url)
    >>> browser.headers['content-type']
    'application/atom+xml; charset=utf-8'
    >>> print browser.contents
    <?xml version="1.0" encoding="utf-8"?>
    <feed xmlns="http://www.w3.org/2005/Atom"
          xmlns:georss="http://www.georss.org/georss"
          xmlns:gml="http://www.opengis.net/gml">
    <BLANKLINE>
    <BLANKLINE>
      <title>places</title>
      <link rel="self"
            href="http://nohost/plone/Members/test_user_1_/places"/>
      <updated/>
      <author/>
      <id>http://nohost/plone/Members/test_user_1_/places</id>
    <BLANKLINE>
      <entry>
        <title>Neverpolis</title>
        <link rel="alternate"
              href="http://nohost/plone/Members/test_user_1_/places/54321">http://nohost/plone/Members/test_user_1_/places/54321</link>
        <id>http://nohost/plone/Members/test_user_1_/places/54321</id>
        <updated/>
        <summary>A testing entity</summary>
    <BLANKLINE>
    <BLANKLINE>
        <georss:where>
          <gml:Point>
            <gml:pos>0.000000 0.000000</gml:pos>
          </gml:Point>
        </georss:where>
    <BLANKLINE>
    <BLANKLINE>
    <BLANKLINE>
      </entry>
    </feed>
    <BLANKLINE>
    <BLANKLINE>

    >>> browser.open("%s/kml" % url)
    >>> 'application/vnd.google-earth.kml+xml; charset=utf-8' in browser.headers['content-type']
    True
    >>> print browser.contents
    <?xml version="1.0" encoding="utf-8"?>
    <kml xmlns="http://earth.google.com/kml/2.1">
    <BLANKLINE>
    <BLANKLINE>
      <Document>
        <Style id="defaultStyle">
          <LineStyle>
            <color>ffff0000</color>
            <width>2</width>
          </LineStyle>
          <PolyStyle>
            <color>33ff0000</color>
          </PolyStyle>
        </Style>
        <name></name>
        <visibility>0</visibility>
        <open>0</open>
        <Placemark>
          <name>Neverpolis</name>
    <BLANKLINE>
          <description>
            <![CDATA[
              <div>
                <p>A testing entity</p>
                <p>URL: 
                  <a href="http://nohost/plone/Members/test_user_1_/places/54321">http://nohost/plone/Members/test_user_1_/places/54321</a>
                </p>
              </div>
            ]]>
          </description>
    <BLANKLINE>
          <styleUrl>#defaultStyle</styleUrl>
    <BLANKLINE>
          <Point>
            <coordinates>0.000000,0.000000,0.000000</coordinates>
          </Point>
    <BLANKLINE>
    <BLANKLINE>
    <BLANKLINE>
        </Placemark>
      </Document>
    </kml>
    <BLANKLINE>
    <BLANKLINE>

    Check views of single place

    >>> url = p.absolute_url()
    >>> browser.open("%s/georss" % url)
    >>> print browser.contents
    <?xml version="1.0" encoding="utf-8"?>
    <feed xmlns="http://www.w3.org/2005/Atom"
          xmlns:georss="http://www.georss.org/georss"
          xmlns:gml="http://www.opengis.net/gml">
    <BLANKLINE>
    <BLANKLINE>
      <title>Neverpolis</title>
      <link rel="self"
            href="http://nohost/plone/Members/test_user_1_/places/54321"/>
      <updated/>
      <author/>
      <id>http://nohost/plone/Members/test_user_1_/places/54321</id>
    <BLANKLINE>
      <entry>
        <title>Neverpolis</title>
        <link rel="alternate"
              href="http://nohost/plone/Members/test_user_1_/places/54321">http://nohost/plone/Members/test_user_1_/places/54321</link>
        <id>http://nohost/plone/Members/test_user_1_/places/54321</id>
        <updated/>
        <summary>A testing entity</summary>
    <BLANKLINE>
    <BLANKLINE>
        <georss:where>
          <gml:Point>
            <gml:pos>0.000000 0.000000</gml:pos>
          </gml:Point>
        </georss:where>
    <BLANKLINE>
    <BLANKLINE>
    <BLANKLINE>
      </entry>
    </feed>
    <BLANKLINE>
    <BLANKLINE>

    >>> browser.open("%s/kml" % url)
    >>> print browser.contents
    <?xml version="1.0" encoding="utf-8"?>
    <kml xmlns="http://earth.google.com/kml/2.1">
    <BLANKLINE>
    <BLANKLINE>
      <Document>
        <Style id="defaultStyle">
          <LineStyle>
            <color>ffff0000</color>
            <width>2</width>
          </LineStyle>
          <PolyStyle>
            <color>33ff0000</color>
          </PolyStyle>
        </Style>
        <name>Neverpolis</name>
        <visibility>0</visibility>
        <open>0</open>
        <Placemark>
          <name>Neverpolis</name>
    <BLANKLINE>
          <description>
            <![CDATA[
              <div>
                <p>A testing entity</p>
                <p>URL: 
                  <a href="http://nohost/plone/Members/test_user_1_/places/54321">http://nohost/plone/Members/test_user_1_/places/54321</a>
                </p>
              </div>
            ]]>
          </description>
    <BLANKLINE>
          <styleUrl>#defaultStyle</styleUrl>
    <BLANKLINE>
          <Point>
            <coordinates>0.000000,0.000000,0.000000</coordinates>
          </Point>
    <BLANKLINE>
    <BLANKLINE>
    <BLANKLINE>
        </Placemark>
      </Document>
    </kml>
    <BLANKLINE>
    <BLANKLINE>

