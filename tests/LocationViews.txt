
Location Views
==============

Setup
-----

    >>> lid = folder.locations.invokeFactory('Location')
    >>> x = getattr(folder.locations, lid)
    >>> _ = x.setGeometry('Point:[-86.4808333333333,34.769722222222]')


Check base view with test browser
---------------------------------

Initialize the test browser

    >>> from Products.Five.testbrowser import Browser
    >>> browser = Browser()
    >>> browser.handleErrors = False

Log all exceptions, which is useful for debugging. Also, clear portlet slots,
to make the test browser less confused by things like the recent portlet and
the navtree.

Test login

    >>> portal_url = self.portal.absolute_url()

The following is useful when writing and debugging testbrowser tests. It lets
us see all error messages in the error_log.

    >>> self.portal.error_log._ignored_exceptions = ()
    >>> self.portal.left_slots = self.portal.right_slots = []

With that in place, we can go to the portal front page and log in. We will
do this using the default user from PloneTestCase:

    >>> from Products.PloneTestCase.setup import portal_owner, default_password
    >>> browser.open(portal_url)

We have the login portlet, so let's use that.

    >>> browser.getControl(name='__ac_name').value = portal_owner
    >>> browser.getControl(name='__ac_password').value = default_password
    >>> browser.getControl(name='submit').click()

Here, we set the value of the fields on the login form and then simulate a
submit click.

We then test that we are still on the portal front page:

    >>> browser.url == portal_url
    True
    
And we ensure that we get the friendly logged-in message:

    >>> "You are now logged in" in browser.contents
    True

Browse the Location

    >>> url = x.absolute_url()
    >>> browser.open(url)

Check the URL 

    >>> browser.url == url
    True
    >>> browser.url.endswith(lid)
    True
    
Check the html content of the view page (description will not appear here)
    
    >>> browser.contents
    '...Geometry...Point:[-86.4808...'

