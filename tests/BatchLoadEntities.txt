Batch Loading of Entities
=========================

Setup
-----

    >>> lpf = self.portal.portal_types['Large Plone Folder']
    >>> lpf_allow = lpf.global_allow
    >>> lpf.global_allow = True

    >>> n = self.portal.portal_types['GeographicName']
    >>> n_allow = n.global_allow
    >>> n.global_allow = True

    >>> n = self.portal.portal_types['EthnicName']
    >>> n_allow = n.global_allow
    >>> n.global_allow = True

    >>> folder = self.folder

    Containers

    >>> _ = folder.invokeFactory('Large Plone Folder', id='names')
    >>> _ = folder.invokeFactory('LocationContainer', id='locations')
    >>> _ = folder.invokeFactory('PlaceContainer', id='places')

Utility tests
-------------

    >>> format_listofstrings([])
    u''
    >>> format_listofstrings(['x'])
    u'x'
    >>> format_listofstrings(['x', 'y'])
    u'x and y'
    >>> format_listofstrings(['x', 'y', 'z'])
    u'x, y and z'
    
    >>> purifyText(u'aaa') == u'aaa'
    True
    >>> purifyText(u'abab') == u'abab'
    True
    >>> purifyText(u'Magie\U000000A01950,\U000000A0989') == u'Magie 1950, 989'
    True
   
Load one entity
---------------

    >>> r = load_place(folder, "%s/batlas-65-2-24-grc.xml" % TEST_DATA)
    >>> r['place_id']
    '0'
    >>> r['name_ids']
    ['aphrodisias', 'ninoe', 'aphrodisieus']
    >>> r['location_ids']
    ['0']

    Test place

    >>> p = getattr(folder.places, '0')
    >>> p.title_or_id()
    u'Aphrodisias/Ninoe/Aphrodisieus'
    >>> p.modernLocation
    u'Geyre'
    >>> p.placeType
    u'settlement'

    Test names

    >>> n0 = getattr(folder.names, 'aphrodisias')
    >>> n0.title
    u'Aphrodisias'
    >>> n0.nameAttested
    u'\u1f08\u03c6\u03c1\u03bf\u03b4\u03b9\u03c3\u03b9\u1f71\u03c2'

    >>> n1 = getattr(folder.names, 'ninoe')
    >>> n1.title
    u'Ninoe'
    >>> n1.nameAttested
    u'\u039d\u03b9\u03bd\u1f79\u03b7'

    >>> n2 = getattr(folder.names, 'aphrodisieus')
    >>> n2.title
    u'Aphrodisieus'
    >>> n2.nameAttested
    u'\u1f08\u03c6\u03c1\u03bf\u03b4\u03b9\u03c3\u03b9\u03b5\u1f7b\u03c2'


    Test locations

    >>> l = getattr(folder.locations, '0')
    >>> l.geometryType
    u'Point'
    >>> l.spatialCoordinates
    u'37.7144599999992 28.7288599999993'
    >>> l.title_or_id()
    u'Point 0'

    Test references

    >>> p.getRefs('name_name')[0] == n0
    True
    >>> p.getRefs('name_name')[1] == n1
    True
    >>> p.getRefs('name_name')[2] == n2
    True
    >>> p.getRefs('location_location')[0] == l
    True

